# 可愛い声スイートスポット探索ソフトウェア 要件定義書

## 1. プロジェクト概要

### 1.1 背景
論文「Finding Kawaii: A Study of Kawaii Vocal Aesthetics in Modern Japanese Popular Music」（arXiv:2507.06235）の研究成果に基づき、音声の基本周波数（F0）とフォルマント周波数（F1-F3）を調整することで「可愛い声」のスイートスポットを探索できるソフトウェアを開発する。

### 1.2 目的
- 音声ファイルの基本周波数とフォルマント周波数をリアルタイムで調整
- 「可愛い声」のスイートスポットを対話的に探索
- 研究・実験・エンターテインメント用途での活用

## 2. 機能要件

### 2.1 音声入力機能
#### 2.1.1 ファイル入力
- **対応フォーマット**: WAV, MP3, M4A, FLAC
- **サンプリングレート**: 16kHz以上（推奨: 44.1kHz）
- **ビット深度**: 16bit以上
- **チャンネル**: モノラル/ステレオ（内部的にモノラル変換）

#### 2.1.2 ドラッグ&ドロップ対応
- ファイルをUIにドラッグ&ドロップで読み込み可能

### 2.2 音声処理機能
#### 2.2.1 基本周波数（F0）制御
- **調整範囲**: 0.5倍 〜 2.0倍
- **デフォルト値**: 1.0倍（変更なし）
- **調整精度**: 0.01単位
- **リアルタイム処理**: 遅延100ms以下

#### 2.2.2 フォルマント周波数制御
- **F1制御範囲**: 0.5倍 〜 2.0倍
- **F2制御範囲**: 0.5倍 〜 2.0倍
- **F3制御範囲**: 0.5倍 〜 2.0倍
- **独立制御**: 各フォルマントを個別に調整可能
- **連動モード**: 全フォルマントを一括調整するオプション

### 2.3 再生機能
#### 2.3.1 ループ再生
- **シームレスループ**: 音声ファイルの終端から始端へ自然に接続
- **ループ区間設定**: 任意の区間をループ可能（オプション）
- **クロスフェード**: ループ接続部のクロスフェード（10-50ms）

#### 2.3.2 再生制御
- **再生/一時停止**: スペースキーまたはボタンクリック
- **停止**: 再生位置を先頭に戻す
- **音量調整**: 0% 〜 100%
- **ミュート機能**: ワンクリックでミュート/解除

### 2.4 プリセット機能
#### 2.4.1 組み込みプリセット
- **オリジナル**: すべてのパラメータを1.0倍
- **可愛い声1**: F0=1.2倍、F1-F3=1.3倍
- **可愛い声2**: F0=1.15倍、F1-F3=1.4倍
- **アニメ声**: F0=1.3倍、F1-F3=1.5倍
- **ロボット声**: F0=1.0倍、F1-F3=0.8倍

#### 2.4.2 カスタムプリセット
- **保存**: 現在の設定を名前付きで保存
- **読み込み**: 保存したプリセットを適用
- **削除**: 不要なプリセットを削除
- **エクスポート/インポート**: JSON形式でプリセットを共有

### 2.5 視覚化機能
#### 2.5.1 波形表示
- **原音波形**: オリジナル音声の波形
- **処理後波形**: リアルタイムで更新される処理後の波形
- **再生位置インジケータ**: 現在の再生位置を表示

#### 2.5.2 スペクトログラム表示
- **周波数スペクトラム**: リアルタイムFFT表示
- **フォルマント表示**: F1-F3の位置を視覚的に表示
- **基本周波数表示**: F0の軌跡を表示

### 2.6 比較機能
#### 2.6.1 A/B比較
- **ワンクリック切り替え**: 原音と処理音を即座に切り替え
- **同期再生**: 同じ再生位置で比較

#### 2.6.2 複数設定比較
- **設定スロット**: 最大4つの異なる設定を保存
- **クイック切り替え**: キーボードショートカットで切り替え

## 3. 非機能要件

### 3.1 パフォーマンス要件
- **起動時間**: 3秒以内
- **ファイル読み込み**: 10MBのファイルを2秒以内
- **処理遅延**: 100ms以下（リアルタイム処理）
- **CPU使用率**: シングルコアで50%以下
- **メモリ使用量**: 500MB以下

### 3.2 ユーザビリティ要件
- **直感的UI**: 音声処理の知識がなくても操作可能
- **日本語対応**: すべてのUI要素を日本語化
- **ツールチップ**: 各コントロールの説明を表示
- **キーボードショートカット**: 主要操作をキーボードで実行可能

### 3.3 互換性要件
- **OS**: Windows 10/11, macOS 10.15+, Ubuntu 20.04+
- **Python**: 3.8以上
- **アーキテクチャ**: x64, ARM64（M1/M2 Mac）
- **メモリ**: 4GB以上推奨
- **ストレージ**: 200MB以上の空き容量

### 3.4 品質要件
- **音質劣化**: 最小限に抑える（SNR > 40dB）
- **アーティファクト**: 位相の不連続性を回避
- **安定性**: 24時間連続動作可能

## 4. UI/UX要件

### 4.1 レイアウト
```
┌─────────────────────────────────────────────────────┐
│  ファイル: sample.wav  [■再生] [■停止] [音量:▁▁▁▁▁]│
├─────────────────────────────────────────────────────┤
│  ┌─────────────────────────────────────────────┐   │
│  │            波形表示エリア                     │   │
│  │  ～～～～～～～～～～～～～～～～～～～～    │   │
│  └─────────────────────────────────────────────┘   │
│                                                     │
│  基本周波数 (F0)    [スライダー] 1.00x             │
│  フォルマント F1    [スライダー] 1.00x             │
│  フォルマント F2    [スライダー] 1.00x             │
│  フォルマント F3    [スライダー] 1.00x             │
│  □ フォルマント連動                                │
│                                                     │
│  プリセット: [ドロップダウン▼]  [保存] [削除]     │
│                                                     │
│  [原音] [処理音] [A/B比較]                         │
│                                                     │
│  ┌─────────────────────────────────────────────┐   │
│  │         スペクトログラム表示                  │   │
│  └─────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────┘
```

### 4.2 操作フロー
1. **ファイル選択**: ドラッグ&ドロップまたはファイル選択ダイアログ
2. **自動再生開始**: ファイル読み込み完了後、自動的にループ再生開始
3. **リアルタイム調整**: スライダーを動かすと即座に音声に反映
4. **プリセット適用**: ワンクリックで事前定義された設定を適用
5. **設定保存**: 気に入った設定をプリセットとして保存

### 4.3 フィードバック
- **視覚的フィードバック**: パラメータ変更時にスライダー値をハイライト
- **音声フィードバック**: 変更が適用されたことを音で確認
- **数値表示**: 現在の倍率を数値で表示（小数点以下2桁）

## 5. 技術仕様

### 5.1 音声処理アルゴリズム
#### 5.1.1 基本周波数シフト
- **手法**: WORLD Vocoder または Phase Vocoder
- **窓関数**: Hann窓
- **フレームサイズ**: 2048サンプル（@44.1kHz）
- **ホップサイズ**: 512サンプル

#### 5.1.2 フォルマントシフト
- **手法**: スペクトル包絡の周波数軸伸縮
- **スペクトル包絡抽出**: ケプストラム法またはLPC分析
- **補間**: 3次スプライン補間

### 5.2 実装技術（デスクトップ版）
- **言語**: Python 3.8+
- **音声処理**: PyWorld (pyworld-prebuilt), NumPy, SciPy
- **音声I/O**: sounddevice, soundfile
- **GUI**: PySide6
- **視覚化**: pyqtgraph, matplotlib
- **ビルド**: PyInstaller（スタンドアロン実行ファイル）
- **開発環境**: VSCode または PyCharm

### 5.3 データフォーマット
#### 5.3.1 プリセットファイル形式
```json
{
  "version": "1.0",
  "name": "カスタムプリセット1",
  "parameters": {
    "f0_ratio": 1.2,
    "f1_ratio": 1.3,
    "f2_ratio": 1.3,
    "f3_ratio": 1.3,
    "formant_link": true
  },
  "metadata": {
    "created_at": "2024-01-15T10:30:00Z",
    "description": "明るく可愛い声"
  }
}
```

## 6. 開発フェーズ

### Phase 1: 基本機能実装（2週間）
- 音声ファイル読み込み
- 基本的なF0シフト
- シンプルなループ再生
- 最小限のUI

### Phase 2: フォルマント制御実装（2週間）
- フォルマント分析・シフト機能
- リアルタイム処理最適化
- パラメータ調整UI

### Phase 3: UI/UX改善（1週間）
- 波形・スペクトログラム表示
- プリセット機能
- A/B比較機能

### Phase 4: 最適化と仕上げ（1週間）
- パフォーマンス最適化
- バグ修正
- ドキュメント作成
- パッケージング

## 7. 制約事項

### 7.1 技術的制約
- **リアルタイム処理**: 完全なゼロレイテンシーは不可能
- **音質**: 極端なパラメータでは音質劣化が避けられない
- **CPU負荷**: 古いPCでは処理が追いつかない可能性

### 7.2 機能的制約
- **音声長**: メモリ制限により、30分以上の音声ファイルは非推奨
- **同時処理**: 複数ファイルの同時処理は非対応
- **エフェクト**: リバーブ等の追加エフェクトは含まない

## 8. 将来の拡張計画

### 8.1 短期的拡張（3-6ヶ月）
- **バッチ処理**: 複数ファイルの一括処理
- **MIDI制御**: MIDIコントローラーでパラメータ操作
- **録音機能**: 処理結果を新規ファイルとして保存

### 8.2 長期的拡張（6-12ヶ月）
- **AI分析**: 「可愛さ」を自動評価するAIモデル
- **リアルタイム入力**: マイク入力のリアルタイム処理
- **プラグイン化**: DAWプラグイン（VST/AU）として提供
- **モバイル対応**: iOS/Androidアプリ開発

## 9. 成功指標

### 9.1 技術的成功指標
- **処理遅延**: 100ms以下を達成
- **音質評価**: MOS (Mean Opinion Score) 4.0以上
- **安定性**: クラッシュ率0.1%以下

### 9.2 ユーザー満足度指標
- **使いやすさ**: ユーザーテストで80%以上が「使いやすい」と評価
- **効果**: 90%以上のユーザーが「可愛い声」への変換を実感
- **継続利用**: 70%以上のユーザーが1週間後も利用

## 10. リスクと対策

### 10.1 技術的リスク
| リスク | 影響度 | 発生確率 | 対策 |
|--------|--------|----------|------|
| リアルタイム処理の遅延 | 高 | 中 | 処理アルゴリズムの最適化、マルチスレッド化 |
| 音質劣化 | 高 | 低 | 高品質アルゴリズム採用、パラメータ制限 |
| クロスプラットフォーム互換性 | 中 | 中 | 徹底的なテスト、CI/CD導入 |

### 10.2 プロジェクトリスク
| リスク | 影響度 | 発生確率 | 対策 |
|--------|--------|----------|------|
| 開発遅延 | 中 | 中 | アジャイル開発、週次進捗確認 |
| 要件変更 | 低 | 高 | MVP優先、段階的機能追加 |

---

本要件定義書は、可愛い声スイートスポット探索ソフトウェアのMVP開発における指針となる文書です。開発の進行に応じて、適宜更新・改訂を行います。